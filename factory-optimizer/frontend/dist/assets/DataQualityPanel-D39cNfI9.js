import{r as N,u as w,j as e,L as y,b as o,g as v,R as _,C as j,S as R,I as C,f as h,Z as S,h as d,i as g,B as k,m as b,k as u}from"./index-BQX9U8G4.js";const E="http://127.0.0.1:8000";async function O(){const t=await fetch(`${E}/plan/data_quality`);if(!t.ok)throw new Error("Failed to fetch data quality");return t.json()}const A=({value:t,size:l="lg"})=>{const r=Math.min(100,Math.max(0,t*10)),a=l==="lg"?70:40,s=l==="lg"?10:6,c=2*Math.PI*a,m=c-r/100*c,x=i=>i>10?"#10b981":i>3?"#22c55e":i>1?"#f59e0b":"#ef4444",n=i=>i>10?"EXCELENTE":i>3?"BOM":i>1?"RAZOÁVEL":"FRACO";return e.jsxs("div",{className:"relative inline-flex items-center justify-center",children:[e.jsxs("svg",{width:(a+s)*2,height:(a+s)*2,className:"-rotate-90",children:[e.jsx("circle",{cx:a+s,cy:a+s,r:a,fill:"none",stroke:"currentColor",strokeWidth:s,className:"text-slate-700"}),e.jsx(b.circle,{cx:a+s,cy:a+s,r:a,fill:"none",stroke:x(t),strokeWidth:s,strokeLinecap:"round",strokeDasharray:c,initial:{strokeDashoffset:c},animate:{strokeDashoffset:m},transition:{duration:1,ease:"easeOut"}})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:`${l==="lg"?"text-3xl":"text-lg"} font-bold`,style:{color:x(t)},children:t.toFixed(1)}),e.jsx("span",{className:`${l==="lg"?"text-sm":"text-xs"} text-slate-400`,children:"SNR"}),l==="lg"&&e.jsx("span",{className:"text-xs font-medium mt-1",style:{color:x(t)},children:n(t)})]})]})},f=({snr:t,maxSNR:l=15})=>{const r=Math.min(100,t/l*100),a=s=>s>10?"bg-emerald-500":s>3?"bg-green-500":s>1?"bg-amber-500":"bg-red-500";return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-slate-700 rounded-full overflow-hidden",children:e.jsx(b.div,{initial:{width:0},animate:{width:`${r}%`},transition:{duration:.5},className:`h-full ${a(t)}`})}),e.jsx("span",{className:"text-xs text-slate-400 w-12 text-right",children:t.toFixed(1)})]})},p=({level:t})=>{const l={EXCELENTE:{bg:"bg-emerald-500/20",text:"text-emerald-400",icon:e.jsx(d,{className:"w-4 h-4"})},EXCELLENT:{bg:"bg-emerald-500/20",text:"text-emerald-400",icon:e.jsx(d,{className:"w-4 h-4"})},BOM:{bg:"bg-green-500/20",text:"text-green-400",icon:e.jsx(d,{className:"w-4 h-4"})},GOOD:{bg:"bg-green-500/20",text:"text-green-400",icon:e.jsx(d,{className:"w-4 h-4"})},RAZOÁVEL:{bg:"bg-amber-500/20",text:"text-amber-400",icon:e.jsx(o,{className:"w-4 h-4"})},FAIR:{bg:"bg-amber-500/20",text:"text-amber-400",icon:e.jsx(o,{className:"w-4 h-4"})},FRACO:{bg:"bg-red-500/20",text:"text-red-400",icon:e.jsx(u,{className:"w-4 h-4"})},POOR:{bg:"bg-red-500/20",text:"text-red-400",icon:e.jsx(u,{className:"w-4 h-4"})}},r=l[t.toUpperCase()]||l.FAIR;return e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium ${r.bg} ${r.text}`,children:[r.icon,t]})},L=({machine:t})=>e.jsxs(b.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-slate-800/50 rounded-lg p-4 border border-slate-700/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"w-4 h-4 text-cyan-400"}),e.jsx("span",{className:"font-medium text-white",children:t.machine_id})]}),e.jsx(p,{level:t.snr_level})]}),e.jsx(f,{snr:t.snr}),e.jsxs("div",{className:"flex justify-between mt-2 text-xs text-slate-500",children:[e.jsxs("span",{children:[t.sample_count," amostras"]}),e.jsxs("span",{children:["μ=",t.mean_time?.toFixed(1)||"N/A","min σ=",t.std_time?.toFixed(1)||"N/A"]})]})]}),M=({operation:t})=>e.jsxs("tr",{className:"border-b border-slate-700/50 hover:bg-slate-800/30",children:[e.jsx("td",{className:"py-3 px-2",children:e.jsx("span",{className:"font-medium text-white",children:t.operation_type})}),e.jsx("td",{className:"py-3 px-2 w-48",children:e.jsx(f,{snr:t.snr})}),e.jsx("td",{className:"py-3 px-2 text-center",children:e.jsx(p,{level:t.snr_level})}),e.jsx("td",{className:"py-3 px-2 text-right text-slate-400",children:t.sample_count})]}),F=()=>{const[t,l]=N.useState(!0),[r,a]=N.useState(!0),{data:s,isLoading:c,error:m,refetch:x}=w({queryKey:["data-quality"],queryFn:O,staleTime:6e4});return c?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(y,{className:"w-8 h-8 text-cyan-400 animate-spin"})}):m||!s?e.jsxs("div",{className:"rounded-xl border border-amber-500/30 bg-amber-500/10 p-6 text-center",children:[e.jsx(o,{className:"w-12 h-12 text-amber-400 mx-auto mb-3"}),e.jsx("p",{className:"text-amber-400 font-medium",children:"Não foi possível carregar dados de qualidade"}),e.jsx("p",{className:"text-sm text-amber-400/70 mt-1",children:"Verifique se existem dados de planeamento"}),e.jsx("button",{onClick:()=>x(),className:"mt-4 px-4 py-2 bg-amber-500/20 hover:bg-amber-500/30 text-amber-400 rounded-lg text-sm",children:"Tentar novamente"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5 text-cyan-500"}),"Qualidade dos Dados (SNR)"]}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Signal-to-Noise Ratio mede a previsibilidade dos tempos de operação"})]}),e.jsxs("button",{onClick:()=>x(),className:"flex items-center gap-2 px-3 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-slate-300 text-sm",children:[e.jsx(_,{className:"w-4 h-4"}),"Atualizar"]})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsxs("div",{className:"col-span-4 flex flex-col items-center justify-center p-6 rounded-2xl border border-slate-700/50 bg-gradient-to-br from-slate-800/50 to-slate-900/50",children:[e.jsx(A,{value:s.global_snr}),e.jsx("p",{className:"mt-4 text-lg font-medium text-white",children:"SNR Global"}),e.jsx(p,{level:s.quality_level})]}),e.jsxs("div",{className:"col-span-8 grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700/50",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-sm mb-2",children:[e.jsx(j,{className:"w-4 h-4"}),"Máquinas"]}),e.jsx("p",{className:"text-2xl font-bold text-white",children:s.total_machines}),e.jsx("p",{className:"text-xs text-slate-500",children:"monitorizadas"})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700/50",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-sm mb-2",children:[e.jsx(R,{className:"w-4 h-4"}),"Operações"]}),e.jsx("p",{className:"text-2xl font-bold text-white",children:s.total_operations}),e.jsx("p",{className:"text-xs text-slate-500",children:"analisadas"})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700/50",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-sm mb-2",children:[e.jsx(o,{className:"w-4 h-4"}),"Alertas"]}),e.jsx("p",{className:"text-2xl font-bold text-amber-400",children:s.low_snr_warnings?.length||0}),e.jsx("p",{className:"text-xs text-slate-500",children:"baixo SNR"})]})]})]}),e.jsx("div",{className:"rounded-xl border border-cyan-500/20 bg-cyan-500/5 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(C,{className:"w-5 h-5 text-cyan-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-cyan-400",children:"O que é SNR (Signal-to-Noise Ratio)?"}),e.jsxs("p",{className:"text-sm text-slate-400 mt-1",children:["SNR = Var(sinal) / Var(ruído). Mede a previsibilidade dos tempos de operação.",e.jsx("br",{}),e.jsx("strong",{children:"SNR > 10:"})," Excelente | ",e.jsx("strong",{children:"3-10:"})," Bom | ",e.jsx("strong",{children:"1-3:"})," Razoável | ",e.jsx("strong",{children:"< 1:"})," Fraco"]})]})]})}),s.low_snr_warnings&&s.low_snr_warnings.length>0&&e.jsxs("div",{className:"rounded-xl border border-amber-500/30 bg-amber-500/10 p-4",children:[e.jsxs("h3",{className:"font-medium text-amber-400 mb-3 flex items-center gap-2",children:[e.jsx(o,{className:"w-4 h-4"}),"Alertas de Baixa Qualidade"]}),e.jsx("ul",{className:"space-y-2",children:s.low_snr_warnings.map((n,i)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-amber-300/80",children:[e.jsx(h,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),n]},i))})]}),s.recommendations&&s.recommendations.length>0&&e.jsxs("div",{className:"rounded-xl border border-emerald-500/30 bg-emerald-500/10 p-4",children:[e.jsxs("h3",{className:"font-medium text-emerald-400 mb-3 flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4"}),"Recomendações"]}),e.jsx("ul",{className:"space-y-2",children:s.recommendations.map((n,i)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-emerald-300/80",children:[e.jsx(d,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),n]},i))})]}),s.snr_by_machine&&s.snr_by_machine.length>0&&e.jsxs("div",{className:"rounded-xl border border-slate-700/50 bg-slate-800/30 p-4",children:[e.jsxs("button",{onClick:()=>l(!t),className:"w-full flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-medium text-white flex items-center gap-2",children:[e.jsx(j,{className:"w-4 h-4 text-cyan-400"}),"SNR por Máquina (",s.snr_by_machine.length,")"]}),t?e.jsx(g,{className:"w-5 h-5 text-slate-400"}):e.jsx(h,{className:"w-5 h-5 text-slate-400"})]}),t&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.snr_by_machine.map(n=>e.jsx(L,{machine:n},n.machine_id))})]}),s.snr_by_operation&&s.snr_by_operation.length>0&&e.jsxs("div",{className:"rounded-xl border border-slate-700/50 bg-slate-800/30 p-4",children:[e.jsxs("button",{onClick:()=>a(!r),className:"w-full flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-medium text-white flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4 text-purple-400"}),"SNR por Tipo de Operação (",s.snr_by_operation.length,")"]}),r?e.jsx(g,{className:"w-5 h-5 text-slate-400"}):e.jsx(h,{className:"w-5 h-5 text-slate-400"})]}),r&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-700 text-slate-400",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Operação"}),e.jsx("th",{className:"text-left py-2 px-2",children:"SNR"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Nível"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Amostras"})]})}),e.jsx("tbody",{children:s.snr_by_operation.map(n=>e.jsx(M,{operation:n},n.operation_type))})]})})]})]})};export{F as DataQualityPanel,F as default};
