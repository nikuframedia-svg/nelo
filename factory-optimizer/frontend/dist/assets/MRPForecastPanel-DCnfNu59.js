import{c as w,r as u,o as v,u as j,l as y,j as e,T as f,U as q,L as b,P as F,A as P,m as N,v as S,b as M,X as $,n as C,w as A,x as E}from"./index-BQX9U8G4.js";import{B as K}from"./bar-chart-2-BZmnfMR_.js";const U=w("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),m="http://127.0.0.1:8000";async function W(){try{const t=await fetch(`${m}/smart-inventory/forecasts`);if(!t.ok)throw new Error;return t.json()}catch{return[{item_code:"SKU-001",item_name:"Widget Alpha",accuracy:92.5,mape:7.5,bias:-2.3,forecasts:[{period:"2024-W45",forecast_qty:150,actual_qty:145,confidence_lower:130,confidence_upper:170},{period:"2024-W46",forecast_qty:165,actual_qty:172,confidence_lower:145,confidence_upper:185},{period:"2024-W47",forecast_qty:180,actual_qty:178,confidence_lower:155,confidence_upper:205},{period:"2024-W48",forecast_qty:200,confidence_lower:170,confidence_upper:230},{period:"2024-W49",forecast_qty:220,confidence_lower:185,confidence_upper:255}]},{item_code:"SKU-002",item_name:"Gadget Beta",accuracy:85.2,mape:14.8,bias:5.1,forecasts:[{period:"2024-W45",forecast_qty:80,actual_qty:72,confidence_lower:65,confidence_upper:95},{period:"2024-W46",forecast_qty:85,actual_qty:88,confidence_lower:70,confidence_upper:100},{period:"2024-W47",forecast_qty:90,actual_qty:95,confidence_lower:75,confidence_upper:105},{period:"2024-W48",forecast_qty:95,confidence_lower:78,confidence_upper:112},{period:"2024-W49",forecast_qty:100,confidence_lower:82,confidence_upper:118}]}]}}async function R(){try{const t=await fetch(`${m}/smart-inventory/forecast-accuracy`);if(!t.ok)throw new Error;return t.json()}catch{return{overall_mape:11.2,overall_bias:1.4,accuracy_by_category:[{category:"Finished Goods",mape:8.5,bias:-1.2},{category:"Raw Materials",mape:12.3,bias:2.8},{category:"Components",mape:15.1,bias:3.5}],best_performers:[{item_code:"SKU-001",mape:7.5},{item_code:"SKU-015",mape:8.2},{item_code:"SKU-023",mape:9.1}],worst_performers:[{item_code:"SKU-042",mape:28.5},{item_code:"SKU-031",mape:24.2},{item_code:"SKU-019",mape:21.8}]}}}async function k(t){const c=new FormData;c.append("file",t);try{const a=await fetch(`${m}/smart-inventory/forecast/upload`,{method:"POST",body:c});if(!a.ok)throw new Error;return a.json()}catch{return{success:!0,items_imported:Math.floor(Math.random()*50)+10,periods:12,warnings:[]}}}async function I(){if(!(await fetch(`${m}/smart-inventory/mrp/run-with-forecast`,{method:"POST"})).ok)throw new Error("Failed to run MRP")}const g=({data:t,height:c=120})=>{const a=Math.max(...t.map(r=>Math.max(r.forecast_qty,r.actual_qty||0,r.confidence_upper)));return e.jsx("div",{className:"flex items-end gap-2 justify-between",style:{height:c},children:t.map((r,i)=>{const n=r.forecast_qty/a*100,h=r.actual_qty?r.actual_qty/a*100:0;return e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1",children:[e.jsxs("div",{className:"w-full flex items-end gap-1 justify-center",style:{height:c-24},children:[e.jsx("div",{className:"w-4 bg-cyan-500/60 rounded-t",style:{height:`${n}%`},title:`Forecast: ${r.forecast_qty}`}),r.actual_qty&&e.jsx("div",{className:"w-4 bg-emerald-500/80 rounded-t",style:{height:`${h}%`},title:`Actual: ${r.actual_qty}`})]}),e.jsx("span",{className:"text-[10px] text-slate-500",children:r.period.split("-")[1]})]},i)})})},L=({value:t,label:c,inverse:a=!1})=>{const r=()=>{const i=a?100-t:t;return i>=90?"text-emerald-400":i>=80?"text-amber-400":"text-red-400"};return e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:`text-3xl font-bold ${r()}`,children:[t.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-slate-500",children:c})]})},B=({forecast:t,isSelected:c,onSelect:a})=>e.jsxs(N.div,{layout:!0,onClick:a,className:`p-4 rounded-xl border cursor-pointer transition-all ${c?"bg-cyan-500/10 border-cyan-500/50":"bg-slate-800/50 border-slate-700/50 hover:border-slate-600"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:t.item_code}),e.jsx("p",{className:"text-sm text-slate-400",children:t.item_name})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`text-xl font-bold ${t.accuracy>=90?"text-emerald-400":t.accuracy>=80?"text-amber-400":"text-red-400"}`,children:[t.accuracy.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Precisão"})]})]}),e.jsx(g,{data:t.forecasts}),e.jsxs("div",{className:"flex items-center justify-between mt-3 text-xs text-slate-500",children:[e.jsxs("span",{children:["MAPE: ",t.mape.toFixed(1),"%"]}),e.jsxs("span",{children:["Bias: ",t.bias>0?"+":"",t.bias.toFixed(1),"%"]})]})]}),Q=()=>{const[t,c]=u.useState(null),[a,r]=u.useState(null),i=v(),{data:n,isLoading:h}=j({queryKey:["forecasts"],queryFn:W}),{data:l,isLoading:T}=j({queryKey:["forecast-accuracy"],queryFn:R}),_=y({mutationFn:k,onSuccess:s=>{r(s),i.invalidateQueries({queryKey:["forecasts"]})}}),p=y({mutationFn:I,onSuccess:()=>{i.invalidateQueries({queryKey:["mrp-runs"]})}}),o=n?.find(s=>s.item_code===t);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5 text-cyan-500"}),"Forecast Integration"]}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Importar previsões e integrar com MRP"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg cursor-pointer",children:[e.jsx(q,{className:"w-4 h-4"}),"Importar Forecast",e.jsx("input",{type:"file",accept:".csv,.xlsx,.json",className:"hidden",onChange:s=>{const x=s.target.files?.[0];x&&_.mutate(x)}})]}),e.jsxs("button",{onClick:()=>p.mutate(),disabled:p.isPending||!n?.length,className:"flex items-center gap-2 px-4 py-2 bg-cyan-600 hover:bg-cyan-500 text-white rounded-lg font-medium disabled:opacity-50",children:[p.isPending?e.jsx(b,{className:"w-4 h-4 animate-spin"}):e.jsx(F,{className:"w-4 h-4"}),"Executar MRP com Forecast"]})]})]}),e.jsx(P,{children:a&&e.jsxs(N.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:`p-4 rounded-xl flex items-center justify-between ${a.success?"bg-emerald-500/10 border border-emerald-500/30":"bg-red-500/10 border border-red-500/30"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[a.success?e.jsx(S,{className:"w-5 h-5 text-emerald-400"}):e.jsx(M,{className:"w-5 h-5 text-red-400"}),e.jsx("span",{className:"text-white",children:a.success?`Importados ${a.items_imported} itens para ${a.periods} períodos`:"Erro na importação"})]}),e.jsx("button",{onClick:()=>r(null),className:"p-1 text-slate-400 hover:bg-slate-800 rounded",children:e.jsx($,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-xl border border-slate-700/50 bg-slate-800/30 text-center",children:[e.jsx(C,{className:"w-6 h-6 text-cyan-400 mx-auto mb-2"}),e.jsxs("p",{className:"text-3xl font-bold text-white",children:[l?(100-l.overall_mape).toFixed(1):"--","%"]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Precisão Geral"})]}),e.jsxs("div",{className:"p-4 rounded-xl border border-slate-700/50 bg-slate-800/30 text-center",children:[e.jsx(K,{className:"w-6 h-6 text-amber-400 mx-auto mb-2"}),e.jsxs("p",{className:"text-3xl font-bold text-white",children:[l?.overall_mape.toFixed(1)||"--","%"]}),e.jsx("p",{className:"text-xs text-slate-500",children:"MAPE"})]}),e.jsxs("div",{className:"p-4 rounded-xl border border-slate-700/50 bg-slate-800/30 text-center",children:[e.jsx(f,{className:"w-6 h-6 text-purple-400 mx-auto mb-2"}),e.jsxs("p",{className:"text-3xl font-bold text-white",children:[l?`${l.overall_bias>0?"+":""}${l.overall_bias.toFixed(1)}`:"--","%"]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Bias"})]}),e.jsxs("div",{className:"p-4 rounded-xl border border-slate-700/50 bg-slate-800/30 text-center",children:[e.jsx(A,{className:"w-6 h-6 text-emerald-400 mx-auto mb-2"}),e.jsx("p",{className:"text-3xl font-bold text-white",children:n?.length||0}),e.jsx("p",{className:"text-xs text-slate-500",children:"Itens com Forecast"})]})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsx("div",{className:"col-span-5 space-y-3 max-h-[500px] overflow-y-auto",children:h?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(b,{className:"w-8 h-8 text-cyan-400 animate-spin"})}):n?.length===0?e.jsxs("div",{className:"text-center py-12 rounded-xl border border-slate-700/50 bg-slate-800/30",children:[e.jsx(U,{className:"w-12 h-12 text-slate-600 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-400",children:"Nenhum forecast importado"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Importe um ficheiro CSV ou JSON"})]}):n?.map(s=>e.jsx(B,{forecast:s,isSelected:t===s.item_code,onSelect:()=>c(s.item_code)},s.item_code))}),e.jsx("div",{className:"col-span-7",children:o?e.jsxs("div",{className:"rounded-xl border border-slate-700/50 bg-slate-800/30 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:o.item_code}),e.jsx("p",{className:"text-sm text-slate-400",children:o.item_name})]}),e.jsx(L,{value:o.accuracy,label:"Precisão"})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-cyan-500/60 rounded"}),e.jsx("span",{className:"text-slate-400",children:"Forecast"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-emerald-500/80 rounded"}),e.jsx("span",{className:"text-slate-400",children:"Actual"})]})]}),e.jsx("div",{className:"bg-slate-900/50 rounded-lg p-4 mb-6",children:e.jsx(g,{data:o.forecasts,height:180})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-slate-400 mb-3",children:"Detalhes por Período"}),e.jsx("div",{className:"overflow-hidden rounded-lg border border-slate-700/50",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-slate-500",children:"Período"}),e.jsx("th",{className:"px-3 py-2 text-right text-slate-500",children:"Forecast"}),e.jsx("th",{className:"px-3 py-2 text-right text-slate-500",children:"Actual"}),e.jsx("th",{className:"px-3 py-2 text-right text-slate-500",children:"IC (95%)"}),e.jsx("th",{className:"px-3 py-2 text-right text-slate-500",children:"Erro"})]})}),e.jsx("tbody",{children:o.forecasts.map((s,x)=>{const d=s.actual_qty?((s.actual_qty-s.forecast_qty)/s.forecast_qty*100).toFixed(1):null;return e.jsxs("tr",{className:"border-t border-slate-700/50",children:[e.jsx("td",{className:"px-3 py-2 text-white font-mono",children:s.period}),e.jsx("td",{className:"px-3 py-2 text-right text-cyan-400",children:s.forecast_qty}),e.jsx("td",{className:"px-3 py-2 text-right text-emerald-400",children:s.actual_qty||"—"}),e.jsxs("td",{className:"px-3 py-2 text-right text-slate-400",children:["[",s.confidence_lower,", ",s.confidence_upper,"]"]}),e.jsx("td",{className:`px-3 py-2 text-right ${d===null?"text-slate-500":Math.abs(parseFloat(d))<10?"text-emerald-400":Math.abs(parseFloat(d))<20?"text-amber-400":"text-red-400"}`,children:d?`${parseFloat(d)>0?"+":""}${d}%`:"—"})]},x)})})]})})]})]}):e.jsx("div",{className:"h-full flex items-center justify-center rounded-xl border border-slate-700/50 bg-slate-800/30 p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(E,{className:"w-16 h-16 text-slate-600 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-medium text-slate-400",children:"Selecione um item"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Para ver detalhes do forecast"})]})})})]}),l&&e.jsx("div",{className:"grid grid-cols-3 gap-4",children:l.accuracy_by_category.map(s=>e.jsxs("div",{className:"p-4 rounded-xl border border-slate-700/50 bg-slate-800/30",children:[e.jsx("h4",{className:"text-sm font-medium text-slate-400 mb-3",children:s.category}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold text-white",children:[(100-s.mape).toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Precisão"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-medium text-slate-300",children:[s.mape.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-slate-500",children:"MAPE"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`text-lg font-medium ${s.bias>0?"text-amber-400":"text-emerald-400"}`,children:[s.bias>0?"+":"",s.bias.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Bias"})]})]})]},s.category))})]})};export{Q as MRPForecastPanel,Q as default};
