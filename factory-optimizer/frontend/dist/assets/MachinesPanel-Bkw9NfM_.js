import{c as $,r as p,u as m,j as e,C as D,R as J,H as ee,G as te,W as f,a as se,F as ae,A as L,m as o,L as q,b as F,d as H,Z as re,S as le,X as ne,T as ie,e as ce,f as de}from"./index-BQX9U8G4.js";const W=$("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]);const oe=$("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]),x="http://127.0.0.1:8000";async function xe(){try{const s=await fetch(`${x}/digital-twin/machines/overview`);if(!s.ok)throw new Error;return s.json()}catch{return{total_machines:24,healthy:18,warning:4,critical:1,offline:1,avg_health_index:82.5,avg_oee:78.3,planned_maintenances_7d:6,overdue_maintenances:2,total_downtime_today:4.5}}}async function me(){try{const s=await fetch(`${x}/digital-twin/machines`);if(!s.ok)throw new Error;return s.json()}catch{return[{machine_id:"m1",name:"CNC-001",cell:"Célula A",type:"CNC",status:"healthy",health_index:94,rul_hours:1800,rul_days:75,oee:85.2,availability:92,performance:95,quality:97.5,last_maintenance:"2024-11-15",next_maintenance:"2025-01-15",downtime_today_hours:.5,downtime_week_hours:2.5},{machine_id:"m2",name:"CNC-002",cell:"Célula A",type:"CNC",status:"healthy",health_index:88,rul_hours:1200,rul_days:50,oee:82.1,availability:89,performance:93,quality:99.2,last_maintenance:"2024-11-20",next_maintenance:"2025-01-20",downtime_today_hours:0,downtime_week_hours:1.2},{machine_id:"m3",name:"PRESS-001",cell:"Célula B",type:"Press",status:"warning",health_index:68,rul_hours:450,rul_days:19,oee:72.5,availability:85,performance:88,quality:96.8,last_maintenance:"2024-10-10",next_maintenance:"2024-12-15",downtime_today_hours:1.5,downtime_week_hours:8},{machine_id:"m4",name:"LATHE-001",cell:"Célula C",type:"Lathe",status:"critical",health_index:42,rul_hours:120,rul_days:5,oee:58.3,availability:70,performance:85,quality:98,last_maintenance:"2024-09-01",next_maintenance:"2024-12-01",downtime_today_hours:2.5,downtime_week_hours:15},{machine_id:"m5",name:"WELD-001",cell:"Célula D",type:"Welding",status:"healthy",health_index:91,rul_hours:2100,rul_days:87,oee:88.7,availability:94,performance:96,quality:98.5,last_maintenance:"2024-11-25",next_maintenance:"2025-02-25",downtime_today_hours:0,downtime_week_hours:.8},{machine_id:"m6",name:"ROBOT-001",cell:"Célula A",type:"Robot",status:"offline",health_index:0,rul_hours:0,rul_days:0,oee:0,availability:0,performance:0,quality:0,last_maintenance:"2024-11-30",next_maintenance:"2024-12-30",downtime_today_hours:8,downtime_week_hours:40}]}}async function he(){try{const s=await fetch(`${x}/digital-twin/maintenance/schedule`);if(!s.ok)throw new Error;return s.json()}catch{return[{id:"mt1",machine_id:"m3",machine_name:"PRESS-001",type:"preventive",status:"overdue",scheduled_date:"2024-12-01",duration_hours:4,description:"Substituição de rolamentos",impact_on_plan:!0},{id:"mt2",machine_id:"m4",machine_name:"LATHE-001",type:"predictive",status:"planned",scheduled_date:"2024-12-10",duration_hours:8,description:"Revisão geral - SHI crítico",impact_on_plan:!0},{id:"mt3",machine_id:"m1",machine_name:"CNC-001",type:"scheduled",status:"planned",scheduled_date:"2025-01-15",duration_hours:2,description:"Calibração programada",impact_on_plan:!1},{id:"mt4",machine_id:"m5",machine_name:"WELD-001",type:"preventive",status:"planned",scheduled_date:"2025-02-25",duration_hours:3,description:"Limpeza de contactos",impact_on_plan:!1}]}}async function pe(){try{const s=await fetch(`${x}/shopfloor/stops/recent`);if(!s.ok)throw new Error;return s.json()}catch{return[{id:"s1",machine_id:"m4",machine_name:"LATHE-001",start_time:"2024-12-05T08:30:00",end_time:"2024-12-05T10:00:00",duration_minutes:90,type:"breakdown",cause:"Falha no motor principal",order_affected:"OP-2024-1234"},{id:"s2",machine_id:"m3",machine_name:"PRESS-001",start_time:"2024-12-05T14:00:00",end_time:"2024-12-05T14:45:00",duration_minutes:45,type:"setup",cause:"Troca de ferramenta",order_affected:"OP-2024-1238"},{id:"s3",machine_id:"m4",machine_name:"LATHE-001",start_time:"2024-12-05T15:30:00",end_time:null,duration_minutes:120,type:"breakdown",cause:"Aquecimento excessivo",order_affected:"OP-2024-1240"},{id:"s4",machine_id:"m1",machine_name:"CNC-001",start_time:"2024-12-05T11:00:00",end_time:"2024-12-05T11:15:00",duration_minutes:15,type:"micro_stop",cause:"Ajuste de parâmetros",order_affected:null}]}}async function ue(){try{const s=await fetch(`${x}/maintenance/workorders?limit=20`);if(!s.ok)throw new Error;return(await s.json()).items||[]}catch{return[{id:1,work_order_number:"WO-20241211-001",machine_id:"m4",title:"PredictiveCare: Critical risk: 65%",description:"Auto-generated by PredictiveCare",priority:"CRITICAL",maintenance_type:"PREDICTIVE",status:"OPEN",source:"PREDICTIVECARE",shi_at_creation:42,rul_at_creation:120,risk_at_creation:.65,created_at:"2024-12-11T10:00:00Z"},{id:2,work_order_number:"WO-20241210-002",machine_id:"m3",title:"PredictiveCare: High risk: 35%",description:"Auto-generated by PredictiveCare",priority:"HIGH",maintenance_type:"PREDICTIVE",status:"PLANNED",source:"PREDICTIVECARE",shi_at_creation:68,rul_at_creation:450,risk_at_creation:.35,created_at:"2024-12-10T08:00:00Z",scheduled_start:"2024-12-15T06:00:00Z"},{id:3,work_order_number:"WO-20241205-003",machine_id:"m1",title:"Preventive: Calibration",description:"Scheduled calibration",priority:"MEDIUM",maintenance_type:"PREVENTIVE",status:"COMPLETED",source:"MANUAL",created_at:"2024-12-05T09:00:00Z"}]}}async function ye(){try{const s=await fetch(`${x}/smart-inventory/spares/forecast?horizon_days=30`);if(!s.ok)throw new Error;return(await s.json()).needs||[]}catch{return[{sku_id:"SPARE-BRG-001",component_name:"Main Spindle Bearing",machine_id:"m4",expected_replacements:.85,recommended_date:"2024-12-18T00:00:00Z",confidence:.72,reason:"Due in 168 hours (accelerated by machine degradation)",criticality:"HIGH",current_stock:2,reorder_needed:!1},{sku_id:"SPARE-BLT-001",component_name:"Drive Belt",machine_id:"m3",expected_replacements:.6,recommended_date:"2024-12-25T00:00:00Z",confidence:.65,reason:"Due in ~14 days",criticality:"MEDIUM",current_stock:3,reorder_needed:!1},{sku_id:"SPARE-FLT-001",component_name:"Hydraulic Filter",machine_id:"m3",expected_replacements:.9,recommended_date:"2024-12-14T00:00:00Z",confidence:.85,reason:"Due in 72 hours",criticality:"MEDIUM",current_stock:1,reorder_needed:!0}]}}async function je(){try{const s=await fetch(`${x}/maintenance/kpis`);if(!s.ok)throw new Error;return s.json()}catch{return{total_work_orders:12,open_work_orders:3,overdue_work_orders:1,completed_last_30d:8,mttr_hours:3.5,failures_prevented:5,predictive_maintenance_rate:.58}}}async function _e(){const s=await fetch(`${x}/maintenance/predictivecare/evaluate`,{method:"POST"});if(!s.ok)throw new Error("Failed to evaluate");return s.json()}const u=({title:s,value:a,subtitle:l,icon:i,color:c,trend:d})=>{const n={cyan:"from-cyan-500/20 to-blue-500/20 border-cyan-500/30 text-cyan-400",emerald:"from-emerald-500/20 to-green-500/20 border-emerald-500/30 text-emerald-400",amber:"from-amber-500/20 to-orange-500/20 border-amber-500/30 text-amber-400",red:"from-red-500/20 to-rose-500/20 border-red-500/30 text-red-400",purple:"from-purple-500/20 to-pink-500/20 border-purple-500/30 text-purple-400"};return e.jsxs("div",{className:`p-4 rounded-xl bg-gradient-to-br ${n[c]} border`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:s}),i]}),e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:a}),l&&e.jsx("p",{className:"text-xs text-slate-500",children:l})]}),d&&e.jsxs("div",{className:`flex items-center gap-1 text-xs ${d.direction==="up"?"text-emerald-400":"text-red-400"}`,children:[d.direction==="up"?e.jsx(ie,{className:"w-3 h-3"}):e.jsx(ce,{className:"w-3 h-3"}),d.value,"%"]})]})]})},be=({status:s,size:a="md"})=>{const l={healthy:{bg:"bg-emerald-500/20",text:"text-emerald-400",label:"Saudável"},warning:{bg:"bg-amber-500/20",text:"text-amber-400",label:"Alerta"},critical:{bg:"bg-red-500/20",text:"text-red-400",label:"Crítico"},offline:{bg:"bg-slate-500/20",text:"text-slate-400",label:"Offline"}},i=l[s]||l.healthy,c=a==="sm"?"px-2 py-0.5 text-xs":"px-3 py-1 text-sm";return e.jsx("span",{className:`rounded-full font-medium ${i.bg} ${i.text} ${c}`,children:i.label})},G=({value:s,size:a=48})=>{const l=()=>s>=80?"stroke-emerald-400":s>=50?"stroke-amber-400":"stroke-red-400",i=(a-6)/2,c=2*Math.PI*i,d=c-s/100*c;return e.jsxs("div",{className:"relative",style:{width:a,height:a},children:[e.jsxs("svg",{width:a,height:a,className:"transform -rotate-90",children:[e.jsx("circle",{cx:a/2,cy:a/2,r:i,fill:"none",stroke:"currentColor",strokeWidth:6,className:"text-slate-700"}),e.jsx("circle",{cx:a/2,cy:a/2,r:i,fill:"none",strokeWidth:6,strokeLinecap:"round",strokeDasharray:c,strokeDashoffset:d,className:l()})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-white",children:s})})]})},Ne=({machine:s,onViewDetails:a,onOpenDigitalTwin:l})=>e.jsxs(o.tr,{initial:{opacity:0},animate:{opacity:1},className:"border-b border-slate-700/30 hover:bg-slate-800/30 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(G,{value:s.health_index,size:40}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:s.name}),e.jsxs("p",{className:"text-xs text-slate-500",children:[s.cell," • ",s.type]})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(be,{status:s.status,size:"sm"})}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsxs("span",{className:`font-medium ${s.rul_days<=7?"text-red-400":s.rul_days<=30?"text-amber-400":"text-white"}`,children:[s.rul_days," dias"]}),e.jsxs("p",{className:"text-xs text-slate-500",children:[s.rul_hours,"h"]})]}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("span",{className:`font-medium ${s.oee>=80?"text-emerald-400":s.oee>=60?"text-amber-400":"text-red-400"}`,children:[s.oee.toFixed(1),"%"]})}),e.jsx("td",{className:"px-4 py-3 text-right text-slate-400 text-sm",children:s.next_maintenance}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("span",{className:s.downtime_today_hours>2?"text-red-400":"text-slate-400",children:[s.downtime_today_hours.toFixed(1),"h"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx("button",{onClick:a,className:"p-1.5 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition",title:"Ver detalhes",children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx("button",{onClick:l,className:"p-1.5 text-cyan-400 hover:text-cyan-300 hover:bg-cyan-500/20 rounded-lg transition",title:"Abrir em Digital Twin",children:e.jsx(W,{className:"w-4 h-4"})})]})})]}),O=({event:s})=>{const a={preventive:"bg-blue-500/20 text-blue-400",predictive:"bg-purple-500/20 text-purple-400",corrective:"bg-red-500/20 text-red-400",scheduled:"bg-slate-500/20 text-slate-400"},l={planned:"border-slate-600",in_progress:"border-cyan-500",completed:"border-emerald-500",overdue:"border-red-500"};return e.jsxs("div",{className:`p-3 rounded-lg bg-slate-800/50 border-l-4 ${l[s.status]}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:s.machine_name}),e.jsx("p",{className:"text-xs text-slate-400",children:s.description})]}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${a[s.type]}`,children:s.type})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-slate-500",children:[e.jsx(H,{className:"w-3 h-3 inline mr-1"}),s.scheduled_date]}),e.jsxs("span",{className:"text-slate-500",children:[e.jsx(oe,{className:"w-3 h-3 inline mr-1"}),s.duration_hours,"h"]}),s.impact_on_plan&&e.jsxs("span",{className:"text-amber-400",children:[e.jsx(F,{className:"w-3 h-3 inline mr-1"}),"Impacto no plano"]})]})]})},ge=({stop:s})=>{const a={setup:"bg-blue-500/20 text-blue-400",breakdown:"bg-red-500/20 text-red-400",micro_stop:"bg-amber-500/20 text-amber-400",planned:"bg-slate-500/20 text-slate-400",quality:"bg-purple-500/20 text-purple-400"},l={setup:"Setup",breakdown:"Avaria",micro_stop:"Microparagem",planned:"Planeada",quality:"Qualidade"};return e.jsxs("tr",{className:"border-b border-slate-700/30",children:[e.jsx("td",{className:"px-3 py-2 text-sm text-white",children:s.machine_name}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${a[s.type]}`,children:l[s.type]})}),e.jsx("td",{className:"px-3 py-2 text-sm text-slate-400",children:s.cause}),e.jsx("td",{className:"px-3 py-2 text-sm text-right",children:e.jsxs("span",{className:s.duration_minutes>60?"text-red-400":"text-slate-400",children:[s.duration_minutes," min"]})}),e.jsx("td",{className:"px-3 py-2 text-sm text-slate-500",children:s.order_affected||"—"}),e.jsx("td",{className:"px-3 py-2 text-sm text-right",children:s.end_time?e.jsx("span",{className:"text-emerald-400",children:"Resolvida"}):e.jsx("span",{className:"text-red-400 animate-pulse",children:"Em curso"})})]})},we=()=>{const[s,a]=p.useState("map"),[l,i]=p.useState("all"),[c,d]=p.useState("all"),[n,y]=p.useState(null),{data:r,isLoading:fe,refetch:K}=m({queryKey:["machines-overview"],queryFn:xe,refetchInterval:3e4}),{data:v,isLoading:U,refetch:V}=m({queryKey:["machines-list"],queryFn:me,refetchInterval:3e4}),{data:w}=m({queryKey:["maintenance-schedule"],queryFn:he}),{data:k}=m({queryKey:["recent-stops"],queryFn:pe,refetchInterval:6e4}),{data:C,refetch:Z}=m({queryKey:["work-orders"],queryFn:ue,refetchInterval:6e4}),{data:E}=m({queryKey:["spare-needs"],queryFn:ye,refetchInterval:3e5}),{data:h}=m({queryKey:["maintenance-kpis"],queryFn:je,refetchInterval:6e4}),[_,A]=p.useState(!1),B=async()=>{A(!0);try{await _e(),Z()}catch(t){console.error("Evaluation failed:",t)}finally{A(!1)}},T=Array.isArray(v)?v:[],P=Array.isArray(w)?w:[],S=Array.isArray(k)?k:[],j=Array.isArray(C)?C:[],b=Array.isArray(E)?E:[],Q=T.filter(t=>!(l!=="all"&&t.status!==l||c!=="all"&&t.cell!==c)),z=[...new Set(T.map(t=>t.cell))],N=P.filter(t=>t.status==="overdue"),I=P.filter(t=>t.status==="planned"),M=j.filter(t=>t.status==="OPEN"||t.status==="PLANNED");j.filter(t=>t.priority==="CRITICAL"||t.priority==="EMERGENCY");const g=b.filter(t=>t.reorder_needed||t.criticality==="CRITICAL"),Y=()=>{K(),V()},R=t=>{window.open(`/digital-twin/machines?machine=${t}`,"_blank")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-purple-400"}),"Máquinas & Manutenção"]}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Estado, saúde, paragens e manutenção dos recursos produtivos"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:Y,className:"flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg text-sm",children:[e.jsx(J,{className:"w-4 h-4"}),"Atualizar"]})})]}),e.jsxs("div",{className:"grid grid-cols-5 gap-4",children:[e.jsx(u,{title:"Máquinas Ativas",value:r?.total_machines||0,subtitle:`${r?.offline||0} offline`,icon:e.jsx(D,{className:"w-5 h-5"}),color:"cyan"}),e.jsx(u,{title:"SHI Médio",value:`${r?.avg_health_index?.toFixed(1)||0}%`,subtitle:`${r?.critical||0} críticas`,icon:e.jsx(ee,{className:"w-5 h-5"}),color:r?.avg_health_index&&r.avg_health_index>=80?"emerald":r?.avg_health_index&&r.avg_health_index>=60?"amber":"red"}),e.jsx(u,{title:"OEE Médio",value:`${r?.avg_oee?.toFixed(1)||0}%`,icon:e.jsx(te,{className:"w-5 h-5"}),color:r?.avg_oee&&r.avg_oee>=80?"emerald":"amber"}),e.jsx(u,{title:"Manutenções 7d",value:r?.planned_maintenances_7d||0,subtitle:`${r?.overdue_maintenances||0} em atraso`,icon:e.jsx(f,{className:"w-5 h-5"}),color:r?.overdue_maintenances&&r.overdue_maintenances>0?"red":"purple"}),e.jsx(u,{title:"Paragens Hoje",value:`${r?.total_downtime_today?.toFixed(1)||0}h`,icon:e.jsx(se,{className:"w-5 h-5"}),color:r?.total_downtime_today&&r.total_downtime_today>4?"red":"amber"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/50 rounded-xl border border-slate-700/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-slate-500"}),e.jsxs("select",{value:l,onChange:t=>i(t.target.value),className:"bg-slate-900 border border-slate-700 rounded-lg px-3 py-1.5 text-sm text-white",children:[e.jsx("option",{value:"all",children:"Todos os estados"}),e.jsx("option",{value:"healthy",children:"Saudáveis"}),e.jsx("option",{value:"warning",children:"Alerta"}),e.jsx("option",{value:"critical",children:"Críticas"}),e.jsx("option",{value:"offline",children:"Offline"})]}),e.jsxs("select",{value:c,onChange:t=>d(t.target.value),className:"bg-slate-900 border border-slate-700 rounded-lg px-3 py-1.5 text-sm text-white",children:[e.jsx("option",{value:"all",children:"Todas as células"}),z.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsx("div",{className:"flex items-center gap-2",children:[{id:"map",label:"Mapa"},{id:"maintenance",label:"Agenda"},{id:"stops",label:"Paragens"},{id:"workorders",label:"Ordens de Trabalho"},{id:"spares",label:"Peças Sobressalentes"}].map(t=>e.jsxs("button",{onClick:()=>a(t.id),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${s===t.id?"bg-cyan-500/20 text-cyan-400 border border-cyan-500/30":"text-slate-400 hover:text-white hover:bg-slate-700/50"}`,children:[t.label,t.id==="workorders"&&M.length>0&&e.jsx("span",{className:"ml-1.5 px-1.5 py-0.5 bg-red-500/20 text-red-400 text-xs rounded-full",children:M.length}),t.id==="spares"&&g.length>0&&e.jsx("span",{className:"ml-1.5 px-1.5 py-0.5 bg-amber-500/20 text-amber-400 text-xs rounded-full",children:g.length})]},t.id))})]}),e.jsxs(L,{mode:"wait",children:[s==="map"&&e.jsx(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"rounded-xl border border-slate-700/50 bg-slate-800/30 overflow-hidden",children:U?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx(q,{className:"w-8 h-8 text-cyan-400 animate-spin"})}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{className:"text-left text-xs text-slate-500 uppercase tracking-wider",children:[e.jsx("th",{className:"px-4 py-3",children:"Máquina"}),e.jsx("th",{className:"px-4 py-3",children:"Estado"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"RUL"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"OEE"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Próx. Manutenção"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Paragem Hoje"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Ações"})]})}),e.jsx("tbody",{children:Q?.map(t=>e.jsx(Ne,{machine:t,onViewDetails:()=>y(t),onOpenDigitalTwin:()=>R(t.machine_id)},t.machine_id))})]})},"map"),s==="maintenance"&&e.jsxs(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"rounded-xl border border-red-500/30 bg-red-500/5 p-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-red-400 mb-4 flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5"}),"Em Atraso (",N.length,")"]}),e.jsxs("div",{className:"space-y-3",children:[N.map(t=>e.jsx(O,{event:t},t.id)),N.length===0&&e.jsx("p",{className:"text-slate-500 text-sm text-center py-4",children:"Sem manutenções em atraso"})]})]}),e.jsxs("div",{className:"rounded-xl border border-slate-700/50 bg-slate-800/30 p-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-cyan-400"}),"Planeadas (",I.length,")"]}),e.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:I.map(t=>e.jsx(O,{event:t},t.id))})]})]},"maintenance"),s==="stops"&&e.jsx(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"rounded-xl border border-slate-700/50 bg-slate-800/30 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{className:"text-left text-xs text-slate-500 uppercase tracking-wider",children:[e.jsx("th",{className:"px-3 py-3",children:"Máquina"}),e.jsx("th",{className:"px-3 py-3",children:"Tipo"}),e.jsx("th",{className:"px-3 py-3",children:"Causa"}),e.jsx("th",{className:"px-3 py-3 text-right",children:"Duração"}),e.jsx("th",{className:"px-3 py-3",children:"Ordem Afetada"}),e.jsx("th",{className:"px-3 py-3 text-right",children:"Estado"})]})}),e.jsxs("tbody",{children:[S.map(t=>e.jsx(ge,{stop:t},t.id)),S.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-3 py-8 text-center text-slate-500",children:"Sem paragens recentes"})})]})]})},"stops"),s==="workorders"&&e.jsxs(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700/50",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Ordens Abertas"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:h?.open_work_orders||0}),e.jsxs("p",{className:"text-xs text-amber-400 mt-1",children:[h?.overdue_work_orders||0," em atraso"]})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700/50",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Falhas Evitadas"}),e.jsx("p",{className:"text-2xl font-bold text-emerald-400",children:h?.failures_prevented||0}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"últimos 30 dias"})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700/50",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"MTTR Médio"}),e.jsxs("p",{className:"text-2xl font-bold text-cyan-400",children:[h?.mttr_hours?.toFixed(1)||"-","h"]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"tempo de reparação"})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700/50",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Taxa Preditiva"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-400",children:[((h?.predictive_maintenance_rate||0)*100).toFixed(0),"%"]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"manutenções preditivas"})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5 text-cyan-400"}),"Ordens de Trabalho"]}),e.jsxs("button",{onClick:B,disabled:_,className:"flex items-center gap-2 px-4 py-2 bg-cyan-500/20 hover:bg-cyan-500/30 text-cyan-400 rounded-lg text-sm border border-cyan-500/30",children:[_?e.jsx(q,{className:"w-4 h-4 animate-spin"}):e.jsx(re,{className:"w-4 h-4"}),_?"Avaliando...":"Avaliar PredictiveCare"]})]}),e.jsx("div",{className:"rounded-xl border border-slate-700/50 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{className:"text-left text-xs text-slate-500 uppercase tracking-wider",children:[e.jsx("th",{className:"px-3 py-3",children:"Ordem"}),e.jsx("th",{className:"px-3 py-3",children:"Máquina"}),e.jsx("th",{className:"px-3 py-3",children:"Título"}),e.jsx("th",{className:"px-3 py-3",children:"Prioridade"}),e.jsx("th",{className:"px-3 py-3",children:"Tipo"}),e.jsx("th",{className:"px-3 py-3",children:"Estado"}),e.jsx("th",{className:"px-3 py-3",children:"SHI/Risco"}),e.jsx("th",{className:"px-3 py-3",children:"Criado"})]})}),e.jsxs("tbody",{children:[j.map(t=>e.jsxs("tr",{className:"border-t border-slate-700/30 hover:bg-slate-800/30",children:[e.jsx("td",{className:"px-3 py-3 text-sm font-mono text-white",children:t.work_order_number}),e.jsx("td",{className:"px-3 py-3 text-sm text-slate-300",children:t.machine_id}),e.jsx("td",{className:"px-3 py-3 text-sm text-white max-w-xs truncate",children:t.title}),e.jsx("td",{className:"px-3 py-3",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${t.priority==="EMERGENCY"?"bg-red-500/20 text-red-400":t.priority==="CRITICAL"?"bg-orange-500/20 text-orange-400":t.priority==="HIGH"?"bg-amber-500/20 text-amber-400":t.priority==="MEDIUM"?"bg-cyan-500/20 text-cyan-400":"bg-slate-500/20 text-slate-400"}`,children:t.priority})}),e.jsx("td",{className:"px-3 py-3 text-sm text-slate-400",children:t.maintenance_type}),e.jsx("td",{className:"px-3 py-3",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${t.status==="OPEN"?"bg-blue-500/20 text-blue-400":t.status==="PLANNED"?"bg-cyan-500/20 text-cyan-400":t.status==="IN_PROGRESS"?"bg-purple-500/20 text-purple-400":t.status==="COMPLETED"?"bg-emerald-500/20 text-emerald-400":t.status==="OVERDUE"?"bg-red-500/20 text-red-400":"bg-slate-500/20 text-slate-400"}`,children:t.status})}),e.jsx("td",{className:"px-3 py-3 text-sm",children:t.shi_at_creation!=null&&e.jsxs("span",{className:"text-slate-400",children:["SHI: ",t.shi_at_creation.toFixed(0),"% • Risk: ",((t.risk_at_creation||0)*100).toFixed(0),"%"]})}),e.jsx("td",{className:"px-3 py-3 text-sm text-slate-500",children:new Date(t.created_at).toLocaleDateString("pt-PT")})]},t.id)),j.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-3 py-8 text-center text-slate-500",children:"Sem ordens de trabalho"})})]})]})})]},"workorders"),s==="spares"&&e.jsxs(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-amber-400"}),"Previsão de Peças Sobressalentes (30 dias)"]}),e.jsxs("div",{className:"text-sm text-slate-400",children:[g.length," peças requerem atenção"]})]}),e.jsx("div",{className:"rounded-xl border border-slate-700/50 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{className:"text-left text-xs text-slate-500 uppercase tracking-wider",children:[e.jsx("th",{className:"px-3 py-3",children:"SKU"}),e.jsx("th",{className:"px-3 py-3",children:"Componente"}),e.jsx("th",{className:"px-3 py-3",children:"Máquina"}),e.jsx("th",{className:"px-3 py-3",children:"Criticidade"}),e.jsx("th",{className:"px-3 py-3",children:"Data Prevista"}),e.jsx("th",{className:"px-3 py-3",children:"Prob."}),e.jsx("th",{className:"px-3 py-3",children:"Stock"}),e.jsx("th",{className:"px-3 py-3",children:"Razão"})]})}),e.jsxs("tbody",{children:[b.map((t,X)=>e.jsxs("tr",{className:`border-t border-slate-700/30 hover:bg-slate-800/30 ${t.reorder_needed?"bg-red-500/5":""}`,children:[e.jsx("td",{className:"px-3 py-3 text-sm font-mono text-white",children:t.sku_id}),e.jsx("td",{className:"px-3 py-3 text-sm text-slate-300",children:t.component_name}),e.jsx("td",{className:"px-3 py-3 text-sm text-slate-400",children:t.machine_id}),e.jsx("td",{className:"px-3 py-3",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${t.criticality==="CRITICAL"?"bg-red-500/20 text-red-400":t.criticality==="HIGH"?"bg-amber-500/20 text-amber-400":"bg-slate-500/20 text-slate-400"}`,children:t.criticality})}),e.jsx("td",{className:"px-3 py-3 text-sm text-slate-300",children:new Date(t.recommended_date).toLocaleDateString("pt-PT")}),e.jsx("td",{className:"px-3 py-3 text-sm",children:e.jsxs("span",{className:`font-medium ${t.expected_replacements>=.8?"text-red-400":t.expected_replacements>=.5?"text-amber-400":"text-slate-400"}`,children:[(t.expected_replacements*100).toFixed(0),"%"]})}),e.jsx("td",{className:"px-3 py-3 text-sm",children:e.jsxs("span",{className:`font-medium ${t.reorder_needed?"text-red-400":"text-emerald-400"}`,children:[t.current_stock||0,t.reorder_needed&&e.jsx("span",{className:"ml-1 text-xs text-red-500",children:"⚠️"})]})}),e.jsx("td",{className:"px-3 py-3 text-sm text-slate-500 max-w-xs truncate",title:t.reason,children:t.reason})]},X)),b.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-3 py-8 text-center text-slate-500",children:"Sem previsões de substituição nos próximos 30 dias"})})]})]})})]},"spares")]}),e.jsx(L,{children:n&&e.jsx(o.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>y(null),children:e.jsxs(o.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-slate-900 rounded-2xl p-6 max-w-2xl w-full border border-slate-700",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(G,{value:n.health_index,size:64}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:n.name}),e.jsxs("p",{className:"text-sm text-slate-400",children:[n.cell," • ",n.type]})]})]}),e.jsx("button",{onClick:()=>y(null),className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg",children:e.jsx(ne,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"SHI"}),e.jsxs("p",{className:"text-xl font-bold text-white",children:[n.health_index,"%"]})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"RUL"}),e.jsxs("p",{className:"text-xl font-bold text-white",children:[n.rul_days,"d"]})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"OEE"}),e.jsxs("p",{className:"text-xl font-bold text-white",children:[n.oee.toFixed(1),"%"]})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Paragens (sem.)"}),e.jsxs("p",{className:"text-xl font-bold text-white",children:[n.downtime_week_hours,"h"]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Disponibilidade"}),e.jsxs("p",{className:"text-lg font-bold text-emerald-400",children:[n.availability,"%"]})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Performance"}),e.jsxs("p",{className:"text-lg font-bold text-cyan-400",children:[n.performance,"%"]})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Qualidade"}),e.jsxs("p",{className:"text-lg font-bold text-purple-400",children:[n.quality,"%"]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>{y(null),R(n.machine_id)},className:"flex-1 flex items-center justify-center gap-2 py-2 bg-cyan-600 hover:bg-cyan-500 text-white rounded-lg font-medium",children:[e.jsx(W,{className:"w-4 h-4"}),"Abrir em Digital Twin"]}),e.jsxs("button",{className:"flex-1 flex items-center justify-center gap-2 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded-lg font-medium",children:[e.jsx(f,{className:"w-4 h-4"}),"Agendar Manutenção"]})]})]})})})]})};export{we as MachinesPanel,we as default};
