import{r as h,o as w,u as j,l as C,j as e,g as k,H as S,q as p,S as L,m as o,v as b,b as T,e as I,L as g,P}from"./index-BQX9U8G4.js";import{B as N}from"./bar-chart-2-BZmnfMR_.js";const u="http://127.0.0.1:8000";async function D(){try{const s=await fetch(`${u}/digital-twin/shi-dt/health-overview`);return s.ok?s.json():[]}catch{return[{machine_id:"m1",machine_name:"CNC 001",health_index:92,rul_hours:1200,degradation_rate:.02,last_update:new Date().toISOString(),status:"healthy",profile:"normal"},{machine_id:"m2",machine_name:"Press 002",health_index:78,rul_hours:600,degradation_rate:.05,last_update:new Date().toISOString(),status:"warning",profile:"heavy"},{machine_id:"m3",machine_name:"Lathe 003",health_index:45,rul_hours:150,degradation_rate:.12,last_update:new Date().toISOString(),status:"critical",profile:"intensive"}]}}async function M(s){const i=await fetch(`${u}/digital-twin/shi-dt/train`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});return i.ok?i.json():{model_id:`model-${Date.now()}`,epochs_completed:s.epochs,final_loss:.0234+Math.random()*.01,validation_loss:.0312+Math.random()*.015,training_time_seconds:s.epochs*2.5,timestamp:new Date().toISOString()}}async function E(){try{const s=await fetch(`${u}/digital-twin/shi-dt/profiles`);if(!s.ok)throw new Error;return s.json()}catch{return[{profile_id:"p1",name:"Normal",description:"Standard operation",load_factor:1,speed_factor:1,temp_factor:1,degradation_modifier:1},{profile_id:"p2",name:"Heavy",description:"High load operation",load_factor:1.5,speed_factor:1.2,temp_factor:1.3,degradation_modifier:1.8},{profile_id:"p3",name:"Light",description:"Low load operation",load_factor:.6,speed_factor:.8,temp_factor:.9,degradation_modifier:.5}]}}const H=({value:s,size:i="md"})=>{const a=()=>s>=80?"stroke-emerald-400":s>=50?"stroke-amber-400":"stroke-red-400",l={sm:60,md:80,lg:120}[i],d=i==="lg"?10:8,c=(l-d)/2,r=2*Math.PI*c,x=r-s/100*r;return e.jsxs("div",{className:"relative",style:{width:l,height:l},children:[e.jsxs("svg",{width:l,height:l,className:"transform -rotate-90",children:[e.jsx("circle",{cx:l/2,cy:l/2,r:c,fill:"none",stroke:"currentColor",strokeWidth:d,className:"text-slate-700"}),e.jsx("circle",{cx:l/2,cy:l/2,r:c,fill:"none",stroke:"currentColor",strokeWidth:d,strokeLinecap:"round",strokeDasharray:r,strokeDashoffset:x,className:a()})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:`font-bold text-white ${i==="lg"?"text-2xl":"text-lg"}`,children:s})})]})},q=({machine:s})=>{const i={healthy:"border-emerald-500/30 bg-emerald-500/5",warning:"border-amber-500/30 bg-amber-500/5",critical:"border-red-500/30 bg-red-500/5"};return e.jsxs(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`p-4 rounded-xl border ${i[s.status]}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{value:s.health_index,size:"sm"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:s.machine_name}),e.jsxs("p",{className:"text-xs text-slate-400",children:["Perfil: ",s.profile]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"RUL"}),e.jsxs("p",{className:"font-bold text-white",children:[s.rul_hours,"h"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-slate-500",children:["Taxa degradação: ",(s.degradation_rate*100).toFixed(1),"%/dia"]}),e.jsxs("span",{className:"text-slate-500",children:["Atualizado: ",new Date(s.last_update).toLocaleTimeString()]})]})]})},A=({profile:s})=>e.jsxs("div",{className:"p-4 rounded-xl border border-slate-700/50 bg-slate-800/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:s.name}),e.jsx("p",{className:"text-xs text-slate-400",children:s.description})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Modifier"}),e.jsxs("p",{className:"font-bold text-cyan-400",children:[s.degradation_modifier,"x"]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-slate-900/50 rounded p-2",children:[e.jsx("p",{className:"text-slate-500",children:"Carga"}),e.jsxs("p",{className:"font-medium text-white",children:[s.load_factor,"x"]})]}),e.jsxs("div",{className:"bg-slate-900/50 rounded p-2",children:[e.jsx("p",{className:"text-slate-500",children:"Velocidade"}),e.jsxs("p",{className:"font-medium text-white",children:[s.speed_factor,"x"]})]}),e.jsxs("div",{className:"bg-slate-900/50 rounded p-2",children:[e.jsx("p",{className:"text-slate-500",children:"Temperatura"}),e.jsxs("p",{className:"font-medium text-white",children:[s.temp_factor,"x"]})]})]})]}),V=()=>{const[s,i]=h.useState("health"),[a,n]=h.useState({epochs:100,learning_rate:.001,batch_size:32,latent_dim:32,beta:1,use_lstm:!0,sequence_length:50}),[l,d]=h.useState(null),c=w(),{data:r,isLoading:x}=j({queryKey:["shi-dt-health"],queryFn:D,refetchInterval:3e4}),{data:f,isLoading:v}=j({queryKey:["shi-dt-profiles"],queryFn:E}),m=C({mutationFn:M,onSuccess:t=>{d(t),c.invalidateQueries({queryKey:["shi-dt-health"]})}}),y=[{id:"health",label:"Saúde das Máquinas",icon:S},{id:"training",label:"Treino CVAE",icon:p},{id:"profiles",label:"Perfis Operacionais",icon:L}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 text-cyan-500"}),"SHI-DT: Smart Health Index Digital Twin"]}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Monitorização de saúde, treino de modelos e perfis operacionais"})]})}),e.jsx("div",{className:"flex items-center gap-2 border-b border-slate-700/50 pb-3",children:y.map(t=>e.jsxs("button",{onClick:()=>i(t.id),className:`flex items-center gap-2 px-4 py-2 rounded-t-lg transition-all ${s===t.id?"bg-cyan-500/20 text-cyan-400 border-b-2 border-cyan-500":"text-slate-400 hover:text-white hover:bg-slate-800/50"}`,children:[e.jsx(t.icon,{className:"w-4 h-4"}),t.label]},t.id))}),s==="health"&&e.jsxs(o.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-xl border border-emerald-500/30 bg-emerald-500/5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-emerald-400 mb-2",children:[e.jsx(b,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Saudáveis"})]}),e.jsx("p",{className:"text-3xl font-bold text-white",children:r?.filter(t=>t.status==="healthy").length||0})]}),e.jsxs("div",{className:"p-4 rounded-xl border border-amber-500/30 bg-amber-500/5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-400 mb-2",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Alerta"})]}),e.jsx("p",{className:"text-3xl font-bold text-white",children:r?.filter(t=>t.status==="warning").length||0})]}),e.jsxs("div",{className:"p-4 rounded-xl border border-red-500/30 bg-red-500/5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-400 mb-2",children:[e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Críticas"})]}),e.jsx("p",{className:"text-3xl font-bold text-white",children:r?.filter(t=>t.status==="critical").length||0})]}),e.jsxs("div",{className:"p-4 rounded-xl border border-cyan-500/30 bg-cyan-500/5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-cyan-400 mb-2",children:[e.jsx(N,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"HI Médio"})]}),e.jsx("p",{className:"text-3xl font-bold text-white",children:r?.length?Math.round(r.reduce((t,_)=>t+_.health_index,0)/r.length):0})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:x?e.jsx("div",{className:"col-span-2 flex items-center justify-center py-12",children:e.jsx(g,{className:"w-8 h-8 text-cyan-400 animate-spin"})}):r?.map(t=>e.jsx(q,{machine:t},t.machine_id))})]}),s==="training"&&e.jsxs(o.div,{initial:{opacity:0},animate:{opacity:1},className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"p-6 rounded-xl border border-slate-700/50 bg-slate-800/30",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(p,{className:"w-5 h-5 text-purple-400"}),"Configuração CVAE"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:"Epochs"}),e.jsx("input",{type:"number",value:a.epochs,onChange:t=>n({...a,epochs:parseInt(t.target.value)}),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:"Learning Rate"}),e.jsx("input",{type:"number",step:"0.0001",value:a.learning_rate,onChange:t=>n({...a,learning_rate:parseFloat(t.target.value)}),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:"Batch Size"}),e.jsx("input",{type:"number",value:a.batch_size,onChange:t=>n({...a,batch_size:parseInt(t.target.value)}),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:"Latent Dimension"}),e.jsx("input",{type:"number",value:a.latent_dim,onChange:t=>n({...a,latent_dim:parseInt(t.target.value)}),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:"Beta (KL Weight)"}),e.jsx("input",{type:"number",step:"0.1",value:a.beta,onChange:t=>n({...a,beta:parseFloat(t.target.value)}),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:"Sequence Length"}),e.jsx("input",{type:"number",value:a.sequence_length,onChange:t=>n({...a,sequence_length:parseInt(t.target.value)}),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white"})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-400",children:[e.jsx("input",{type:"checkbox",checked:a.use_lstm,onChange:t=>n({...a,use_lstm:t.target.checked}),className:"accent-cyan-500"}),"Usar LSTM no Encoder"]})}),e.jsx("button",{onClick:()=>m.mutate(a),disabled:m.isPending,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-purple-600 to-cyan-600 hover:from-purple-500 hover:to-cyan-500 text-white rounded-lg font-medium disabled:opacity-50",children:m.isPending?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"w-5 h-5 animate-spin"}),"A treinar modelo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-5 h-5"}),"Iniciar Treino CVAE"]})})]})]}),e.jsxs("div",{className:"p-6 rounded-xl border border-slate-700/50 bg-slate-800/30",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(N,{className:"w-5 h-5 text-cyan-400"}),"Resultados do Treino"]}),l?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-3 bg-slate-900/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Epochs Completadas"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:l.epochs_completed})]}),e.jsxs("div",{className:"p-3 bg-slate-900/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Tempo de Treino"}),e.jsxs("p",{className:"text-2xl font-bold text-white",children:[l.training_time_seconds.toFixed(1),"s"]})]}),e.jsxs("div",{className:"p-3 bg-slate-900/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Loss Final"}),e.jsx("p",{className:"text-2xl font-bold text-emerald-400",children:l.final_loss.toFixed(4)})]}),e.jsxs("div",{className:"p-3 bg-slate-900/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Validation Loss"}),e.jsx("p",{className:"text-2xl font-bold text-cyan-400",children:l.validation_loss.toFixed(4)})]})]}),e.jsxs("div",{className:"p-4 bg-emerald-500/10 border border-emerald-500/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-emerald-400 mb-2",children:[e.jsx(b,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Modelo treinado com sucesso!"})]}),e.jsxs("p",{className:"text-sm text-slate-400",children:["ID: ",e.jsx("span",{className:"font-mono text-white",children:l.model_id})]})]}),e.jsxs("div",{className:"p-4 bg-slate-900/50 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-slate-400 mb-2",children:"Fórmula do Health Index"}),e.jsx("code",{className:"text-xs text-cyan-400 font-mono",children:"H(t) = 100 × exp(-α × E_rec(t))"}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Onde E_rec(t) é o erro de reconstrução do CVAE no tempo t"})]})]}):e.jsx("div",{className:"h-64 flex items-center justify-center border border-dashed border-slate-700 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(p,{className:"w-12 h-12 text-slate-600 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-400",children:"Nenhum treino realizado"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Configure os parâmetros e inicie o treino"})]})})]})]}),s==="profiles"&&e.jsxs(o.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Perfis operacionais afetam a degradação das máquinas"}),e.jsxs("button",{className:"flex items-center gap-2 px-3 py-1.5 bg-cyan-500/20 hover:bg-cyan-500/30 text-cyan-400 rounded-lg text-sm",children:[e.jsx(F,{className:"w-4 h-4"}),"Novo Perfil"]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:v?e.jsx("div",{className:"col-span-3 flex items-center justify-center py-12",children:e.jsx(g,{className:"w-8 h-8 text-cyan-400 animate-spin"})}):f?.map(t=>e.jsx(A,{profile:t},t.profile_id))}),e.jsxs("div",{className:"p-4 bg-slate-900/50 rounded-lg border border-slate-700/50",children:[e.jsx("h4",{className:"text-sm font-medium text-white mb-2",children:"Modelo de Degradação"}),e.jsx("code",{className:"text-xs text-cyan-400 font-mono block",children:"P(t) = P(0) - Δ_d × f(uso_acumulado, regime)"}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Onde Δ_d é a taxa de degradação base e f é a função de ajuste por perfil operacional"})]})]})]})},F=({className:s})=>e.jsx("svg",{className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})});export{V as SHIDTTrainingPanel,V as default};
