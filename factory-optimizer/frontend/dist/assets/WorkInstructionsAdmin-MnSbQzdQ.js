import{c as _,r as u,o as S,u as v,l as y,j as e,S as P,L as w,P as I,t as g,y as k,w as q,f as T,A as F,m as f,v as M,X as $}from"./index-BQX9U8G4.js";import{S as D}from"./save-C9NKLrmT.js";const E=_("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),j="http://127.0.0.1:8000";async function A(){const s=await fetch(`${j}/work-instructions`);return s.ok?s.json():[]}async function O(s){const t=await fetch(`${j}/work-instructions/${s}`);if(!t.ok)throw new Error("Failed to fetch instruction");return t.json()}async function Q(s){const t=await fetch(`${j}/work-instructions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok)throw new Error("Failed to create instruction");return t.json()}async function K(s){const t=await fetch(`${j}/work-instructions/${s}/release`,{method:"POST"});if(!t.ok)throw new Error("Failed to release instruction");return t.json()}async function L(){const s=await fetch(`${j}/work-instructions/demo`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_name:"Demo Product",num_steps:5})});if(!s.ok)throw new Error("Failed to create demo");return s.json()}const C=({status:s})=>{const t={draft:{bg:"bg-amber-500/20",text:"text-amber-400"},released:{bg:"bg-emerald-500/20",text:"text-emerald-400"},archived:{bg:"bg-slate-500/20",text:"text-slate-400"}},i=t[s]||t.draft;return e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${i.bg} ${i.text}`,children:s.toUpperCase()})},R=({instruction:s,onSelect:t,onRelease:i,isSelected:l})=>e.jsxs(f.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},onClick:t,className:`cursor-pointer p-4 rounded-xl border transition-all ${l?"bg-cyan-500/10 border-cyan-500/50":"bg-slate-800/50 border-slate-700/50 hover:border-slate-600"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 text-cyan-400"}),e.jsx("span",{className:"font-medium text-white",children:s.title})]}),e.jsx(C,{status:s.status})]}),e.jsx("p",{className:"text-sm text-slate-400 mb-3 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{children:[s.steps_count," passos"]}),e.jsxs("span",{children:[s.quality_checks_count," checks"]}),e.jsxs("span",{children:[s.estimated_time_minutes," min"]})]}),e.jsxs("span",{children:["v",s.version]})]}),s.status==="draft"&&e.jsx("div",{className:"mt-3 pt-3 border-t border-slate-700/50 flex gap-2",children:e.jsxs("button",{onClick:d=>{d.stopPropagation(),i()},className:"flex-1 flex items-center justify-center gap-1 px-3 py-1.5 bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-400 rounded-lg text-sm",children:[e.jsx(M,{className:"w-4 h-4"}),"Publicar"]})})]}),z=({step:s,onChange:t,onDelete:i})=>e.jsxs("div",{className:"p-4 rounded-lg border border-slate-700/50 bg-slate-800/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 flex items-center justify-center bg-cyan-500/20 text-cyan-400 text-sm font-medium rounded",children:s.sequence}),e.jsx("input",{type:"text",value:s.title,onChange:l=>t({...s,title:l.target.value}),className:"bg-transparent border-none text-white font-medium focus:outline-none",placeholder:"Título do passo"})]}),e.jsx("button",{onClick:i,className:"p-1 text-red-400 hover:bg-red-500/20 rounded",children:e.jsx(E,{className:"w-4 h-4"})})]}),e.jsx("textarea",{value:s.description,onChange:l=>t({...s,description:l.target.value}),className:"w-full bg-slate-900/50 border border-slate-700 rounded-lg p-2 text-sm text-slate-300 resize-none",rows:2,placeholder:"Descrição do passo..."}),e.jsxs("div",{className:"flex items-center gap-4 mt-3",children:[e.jsxs("select",{value:s.step_type,onChange:l=>t({...s,step_type:l.target.value}),className:"bg-slate-900 border border-slate-700 rounded-lg px-2 py-1 text-sm text-white",children:[e.jsx("option",{value:"instruction",children:"Instrução"}),e.jsx("option",{value:"measurement",children:"Medição"}),e.jsx("option",{value:"checklist",children:"Checklist"}),e.jsx("option",{value:"photo",children:"Foto"}),e.jsx("option",{value:"confirmation",children:"Confirmação"})]}),e.jsxs("select",{value:s.input_type,onChange:l=>t({...s,input_type:l.target.value}),className:"bg-slate-900 border border-slate-700 rounded-lg px-2 py-1 text-sm text-white",children:[e.jsx("option",{value:"none",children:"Sem input"}),e.jsx("option",{value:"boolean",children:"Confirmação"}),e.jsx("option",{value:"numeric",children:"Numérico"}),e.jsx("option",{value:"text",children:"Texto"}),e.jsx("option",{value:"select",children:"Seleção"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-400",children:[e.jsx("input",{type:"checkbox",checked:s.is_critical,onChange:l=>t({...s,is_critical:l.target.checked}),className:"accent-red-500"}),"Crítico"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-400",children:[e.jsx("input",{type:"checkbox",checked:s.is_quality_check,onChange:l=>t({...s,is_quality_check:l.target.checked}),className:"accent-amber-500"}),"Quality Check"]})]})]}),V=({isOpen:s,onClose:t,onCreate:i})=>{const[l,d]=u.useState(""),[b,h]=u.useState(""),[c,p]=u.useState([]),N=()=>{p([...c,{step_id:`step-${Date.now()}`,sequence:c.length+1,title:"",description:"",step_type:"instruction",input_type:"none",is_critical:!1,is_quality_check:!1}])},n=()=>{i({title:l,description:b,steps:c.map((r,x)=>({...r,sequence:x+1}))}),t()};return s?e.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:t,children:e.jsxs(f.div,{initial:{scale:.95},animate:{scale:1},className:"bg-slate-900 rounded-2xl p-6 max-w-3xl w-full max-h-[90vh] overflow-y-auto",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(g,{className:"w-5 h-5 text-cyan-400"}),"Nova Instrução de Trabalho"]}),e.jsx("button",{onClick:t,className:"p-2 text-slate-400 hover:bg-slate-800 rounded-lg",children:e.jsx($,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:"Título"}),e.jsx("input",{type:"text",value:l,onChange:r=>d(r.target.value),className:"w-full px-4 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white focus:border-cyan-500 focus:outline-none",placeholder:"Nome da instrução..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:"Descrição"}),e.jsx("textarea",{value:b,onChange:r=>h(r.target.value),className:"w-full px-4 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white focus:border-cyan-500 focus:outline-none resize-none",rows:3,placeholder:"Descrição da instrução..."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"text-sm text-slate-400",children:["Passos (",c.length,")"]}),e.jsxs("button",{onClick:N,className:"flex items-center gap-1 px-3 py-1 bg-cyan-500/20 hover:bg-cyan-500/30 text-cyan-400 rounded-lg text-sm",children:[e.jsx(g,{className:"w-4 h-4"}),"Adicionar Passo"]})]}),e.jsx("div",{className:"space-y-3",children:c.map((r,x)=>e.jsx(z,{step:r,onChange:m=>{const o=[...c];o[x]=m,p(o)},onDelete:()=>p(c.filter((m,o)=>o!==x))},r.step_id))})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6 pt-4 border-t border-slate-700",children:[e.jsx("button",{onClick:t,className:"flex-1 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg",children:"Cancelar"}),e.jsxs("button",{onClick:n,disabled:!l||c.length===0,className:"flex-1 py-2 bg-cyan-600 hover:bg-cyan-500 text-white rounded-lg disabled:opacity-50 flex items-center justify-center gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),"Criar Instrução"]})]})]})}):null},G=()=>{const[s,t]=u.useState(null),[i,l]=u.useState(!1),[d,b]=u.useState("all"),h=S(),{data:c,isLoading:p,refetch:N}=v({queryKey:["work-instructions"],queryFn:A}),{data:n}=v({queryKey:["work-instruction",s],queryFn:()=>s?O(s):null,enabled:!!s}),r=y({mutationFn:Q,onSuccess:()=>{h.invalidateQueries({queryKey:["work-instructions"]})}}),x=y({mutationFn:K,onSuccess:()=>{h.invalidateQueries({queryKey:["work-instructions"]})}}),m=y({mutationFn:L,onSuccess:()=>{h.invalidateQueries({queryKey:["work-instructions"]})}}),o=c?.filter(a=>d==="all"?!0:a.status===d)||[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-cyan-500"}),"Gestão de Instruções de Trabalho"]}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Criar, editar e publicar instruções para o chão-de-fábrica"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>m.mutate(),disabled:m.isPending,className:"flex items-center gap-2 px-3 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg text-sm",children:[m.isPending?e.jsx(w,{className:"w-4 h-4 animate-spin"}):e.jsx(I,{className:"w-4 h-4"}),"Criar Demo"]}),e.jsxs("button",{onClick:()=>l(!0),className:"flex items-center gap-2 px-4 py-2 bg-cyan-600 hover:bg-cyan-500 text-white rounded-lg font-medium",children:[e.jsx(g,{className:"w-4 h-4"}),"Nova Instrução"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[["all","draft","released"].map(a=>e.jsx("button",{onClick:()=>b(a),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${d===a?"bg-cyan-500/20 text-cyan-400 border border-cyan-500/30":"bg-slate-800/50 text-slate-400 hover:bg-slate-700/50"}`,children:a==="all"?"Todas":a==="draft"?"Rascunho":"Publicadas"},a)),e.jsxs("span",{className:"text-sm text-slate-500 ml-2",children:[o.length," instrução(ões)"]})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsx("div",{className:"col-span-5 space-y-3",children:p?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(w,{className:"w-8 h-8 text-cyan-400 animate-spin"})}):o.length===0?e.jsxs("div",{className:"text-center py-12 rounded-xl border border-slate-700/50 bg-slate-800/30",children:[e.jsx(k,{className:"w-12 h-12 text-slate-600 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-400",children:"Nenhuma instrução encontrada"}),e.jsx("button",{onClick:()=>l(!0),className:"mt-4 px-4 py-2 bg-cyan-500/20 text-cyan-400 rounded-lg text-sm",children:"Criar primeira instrução"})]}):e.jsx("div",{className:"space-y-3 max-h-[600px] overflow-y-auto",children:o.map(a=>e.jsx(R,{instruction:a,isSelected:s===a.instruction_id,onSelect:()=>t(a.instruction_id),onRelease:()=>x.mutate(a.instruction_id)},a.instruction_id))})}),e.jsx("div",{className:"col-span-7",children:n?e.jsxs("div",{className:"rounded-xl border border-slate-700/50 bg-slate-800/30 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:n.title}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:n.description})]}),e.jsx(C,{status:n.status})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Passos"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:n.steps?.length||0})]}),e.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Versão"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:n.version})]}),e.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Tempo Est."}),e.jsxs("p",{className:"text-2xl font-bold text-white",children:[n.estimated_time_minutes," min"]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-slate-400 mb-3",children:["Passos (",n.steps?.length||0,")"]}),e.jsx("div",{className:"space-y-2 max-h-80 overflow-y-auto",children:n.steps?.map(a=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-900/50 rounded-lg",children:[e.jsx("span",{className:"w-6 h-6 flex items-center justify-center bg-cyan-500/20 text-cyan-400 text-sm font-medium rounded",children:a.sequence}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-white",children:a.title}),e.jsx("p",{className:"text-sm text-slate-400 line-clamp-1",children:a.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a.is_critical&&e.jsx("span",{className:"px-2 py-0.5 bg-red-500/20 text-red-400 text-xs rounded",children:"Crítico"}),a.is_quality_check&&e.jsx("span",{className:"px-2 py-0.5 bg-amber-500/20 text-amber-400 text-xs rounded",children:"QC"})]})]},a.step_id))})]}),n.model_3d_url&&e.jsxs("div",{className:"mt-6 p-4 bg-slate-900/50 rounded-lg border border-slate-700/50",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 mb-2",children:[e.jsx(q,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Modelo 3D Associado"})]}),e.jsx("p",{className:"text-sm text-cyan-400 font-mono",children:n.model_3d_url})]})]}):e.jsx("div",{className:"h-full flex items-center justify-center rounded-xl border border-slate-700/50 bg-slate-800/30 p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(T,{className:"w-16 h-16 text-slate-600 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-medium text-slate-400",children:"Selecione uma instrução"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Ou crie uma nova instrução de trabalho"})]})})})]}),e.jsx(F,{children:i&&e.jsx(V,{isOpen:i,onClose:()=>l(!1),onCreate:a=>r.mutate(a)})})]})};export{G as WorkInstructionsAdmin,G as default};
